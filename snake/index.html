<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Levi4</title>
        

        <!-- jquery -->
        <script type="text/javascript" src="jquery-2.1.1.min.js"></script>

    </head>
    <body>
        <div id=pane style="position: absolute; top: 0px; left: 0px; height: 100%; width: 100%; background-color: black">
            <div id="message" class="message"></div>
            <div id="food" class="block food"></div>
        </div>
    </body>

    <style>

        .block {
            position: absolute;
            background-color: white;
            border: 1px solid black;
            box-sizing: border-box;
        }
        
        .food {
            background-color: red;
        }

        .message {
            position: absolute;
            height: 400px;
            width: 800px;
            margin-left: -400px;
            margin-top: -200px;
            top: 50%;
            left: 50%;
            line-height: 400px;
            font-family: Arial;
            font-size: 200px;
            text-align: center;
            color: white;
            text-shadow: -3px 0 black, 0 3px black, 3px 0 black, 0 -3px black;
        }

    </style>

    <script>
        // CONSTANTS //
        var SPEED = 50;             // milliseconds between update
        var SIZE = 20;              // block size
        var LENGTH = 5;             // length of the snake initially

        var running;                // if a game has been started
        var set;                    // if a game is ready
        var turned;                 // to keep from turning more than once per update

        var score;

        var width;                  // number of tiles across
        var height;                 // number of tiles top to bottom


        var positions;              // 2D array to keep track of positions

        var loop;                   // interval loop

        var direction;              // direction to update in
        var blocks;

        var tail;                   // pointer to the tail block
        var head;                   // pointer to head block

        function update() {
            var x = head.x + direction.x;
            var y = head.y + direction.y;

            // check position
            var check = checkPosition(x, y);
            if (check == 1) {                   // hit something
                gameOver();
                return;
            }
            else if (check == 2) {              // hit food
                score++;
                createBlock(0,0)
                placeFood();
            }

            // move tail block to front
            positions[tail.x][tail.y] = 0;
            positions[x][y] = 1;
            moveTo(tail, x, y);

            // update linked list
            head.next = tail;
            head = tail;
            tail = tail.next;

            turned = false;
        }

        function placeFood() {
            var x = Math.floor(width * Math.random());
            var y = Math.floor(height * Math.random());

            if (positions[x][y] == 0) {
                moveTo($("#food"), x, y);
                positions[x][y] = 2;
            }
            else placeFood();
        }

        function gameOver() {
            stopGame();
            $("#message").empty().append(score);
            $(".block").css("zIndex", 0);
            $("#message").css("zIndex", 1);
            score = 0;
            set = false;
        }

        function checkPosition(x, y) {
            // check to see if it's in the box
            if (x < 0 || x >= width || y < 0 || y >= height) return 1;

            // check to see if it hit it's tail or the food
            return positions[x][y];
        }

        function moveTo(block, x, y) {
            $(block).css("top", y * SIZE + "px");
            $(block).css("left", x * SIZE + "px");
            block.x = x;
            block.y = y;
        }

        function createBlock(x, y) {
            var block = document.createElement("div");
            block.className = "block";
            $(block).css("height", SIZE);
            $(block).css("width", SIZE);

            moveTo(block, x, y);                            // position the block
            block.x = x;
            block.y = y;
            positions[x][y] = 1;

            block.next = tail;                              // update linked list
            tail = block;

            blocks.push(block);
            $("#pane").append(block);
        }

        function startGame() {
            // start update loop
            loop = setInterval(update, SPEED);
            running = true;
        }

        function stopGame() {
            window.clearInterval(loop);
            running = false;
        }

        function keyHandler(e) {
            //console.log(e.keyCode);

            // arrow keys
            if (running && !turned) {
                if (e.keyCode == 37 && direction.y != 0) direction = {x: -1, y: 0};
                else if (e.keyCode == 38 && direction.x != 0) direction = {x: 0, y: -1};
                else if (e.keyCode == 39 && direction.y != 0) direction = {x: 1, y: 0};
                else if (e.keyCode == 40 && direction.x != 0) direction = {x: 0, y: 1};
                else {}
                turned = true;
            }
            
            // space bar
            if (e.keyCode == 32) {
                //console.log(set, running);
                if (!set) {
                    setup();
                }
                else if (set && !running) {
                    startGame();
                }
                else if (set && running) {
                    stopGame();
                }
            }
            else {}

        }

        function setup() {
            running = false;        // if a game has been started
            set = false;            // if a game is ready
            turned = false;         // to keep from turning more than once per update

            score = 0;

            width = 0;              // number of tiles across
            height = 0;             // number of tiles top to bottom

            positions = null;       // 2D array to keep track of positions

            loop = null;            // interval loop

            direction = {           // direction to update in
                x: 1,
                y: 0
            };
            blocks = [];

            tail = null;            // pointer to the tail block
            head = null;

            // clear the old blocks
            $(".block").remove(":not(#food)");
            blocks = [];
            $("#message").empty();

            // resize window
            $("#pane").css("height", Math.floor(window.innerHeight / SIZE) * SIZE);
            height = Math.floor(window.innerHeight / SIZE);
            $("#pane").css("width", Math.floor(window.innerWidth / SIZE) * SIZE);
            width = Math.floor(window.innerWidth / SIZE);

            // create position array
            positions = new Array(width);
            for (var j = 0; j < width; j++) {
                positions[j] = new Array(height);
                for (var k = 0; k < height; k++) {
                    positions[j][k] = 0;
                }
            }

            // initialize snake
            for (var i = LENGTH - 1; i >= 0; i--) {
                createBlock(i, 0);
            }
            head = blocks[0];

            // place food
            $("#food").css("height", SIZE);
            $("#food").css("width", SIZE);
            placeFood();

            set = true;
        }

        function updateSpeed(speed) {
            SPEED = speed;
            gameOver();
            setup();
        }

        function updateSize(size) {
            SIZE = size;
            gameOver();
            setup();
        }

        function updateLength(length) {
            LENGTH = length;
            gameOver();
            setup();
        }

        $(document).ready(function() {
            setup();

            // initiate listener
            $(document).keydown(function(e) {keyHandler(e);});
        });

    </script>
</html>
